fn waveshaper($f) {
    $this = new()

    $this.f = $f

    $this.gen = { // $this, $frames
        $this = $1
        $frames = $2
        $in_channels = $3

        $sig = new($frames, 1, FLOAT32)

        $i = 0 while $i < $frames {
            $sig[$i] = $this.f($this.buf[$i])
            $i + 1
        }
        ret ($sig)
    }
    ret ($this)
}
