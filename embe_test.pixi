include "embe.pixi"

show_memory_debug_messages(0)

$o1 = osc_sin(440, 0.2)
$o2 = osc_sin(660, 0.7)
$o3 = osc_noise(0.5)
$in = in(0)

// Create mixer
$m = mix()

// Join ("j") our oscillators to the mixer
j($m, $o1)
j($m, $o2)
j($m, $o3)
j($m, $in)

// Create band-pass filter with cutoff frequency == 110Hz
// and resonance value = 100% (if we will use value > 100)
// filter will start to self-oscillate
$hz0 = 220
$hz = $hz0

/*$ws = waveshaper({
    $v = atan($1)
    ret($v)
})

j($ws, $m)*/

$f = flt_bp($hz, 80)
j($f, $m)

$lfo = lfo()
a($f, 'Freq', $lfo)

// Create visualizer
$v = vis_fft()

// Join our filter to visualizer
j($v, $f)

// Send our filter to the output
out($f)

$d = 1
while (1) {
    // Some cutoff modulation
    /*if TICK > SRATE / 4 {
        TICK - SRATE / 4
        $hz * pow(2, $d / 12)

        if $hz > SRATE / 2 {
            $hz = $hz0
        }

        $f.Freq = $hz
    }*/

    // Some visualization
    $v.render($v)

    while( get_event() ) { if EVT[ EVT_TYPE ] == EVT_QUIT { halt } }
}
