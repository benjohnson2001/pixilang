include "embe.pixi"
include "embe/osc.pixi"
include "embe/mod.pixi"
include "embe/biquad.pixi"
include "embe/comb.pixi"
include "embe/waveshaper.pixi"
include "embe/vis.pixi"

//set_pixel_size(WINDOW_XSIZE / 240)
resize(get_screen(), WINDOW_XSIZE, WINDOW_YSIZE)

/*$o1 = osc_noise(0.2)
$o2 = osc_sqr(660, 0.05)
$o3 = osc_sqr(9900, 0.05)
$f = lp(440, 0.996, 0.01)
$c = comb(440, 0.96)
$m = mix(0.25)
$ws = waveshaper({
    $v = $1
    if $v > 0.99 {
        $v = 0.99
    }
    if $v < -0.99 {
        $v = -0.99
    }
    ret ($v)
})

a($o1)
a($o2)
a($o3)
a($m)
a($c)
a($f)
a($ws)

j($m, $o1)
j($m, $o2)
j($m, $o3)
j($c, $m)
j($f, $c)
j($ws, $f)

$v = vis_fft($ws)
out($ws)
*/

$ws = waveshaper({
    $v = $1
    if $v > 0.99 {
        $v = 0.99
    }
    if $v < -0.99 {
        $v = -0.99
    }
    ret ($v)
})

$noise = osc_noise(0.5)
$lp = lp(4400, 0.8, 0.001)

a($lp)
a($noise)

$i = 1 while ($i <= 64) {
    $comb = comb($i * 32, 0.996, 0.25)
    $bp = bp($i * 64, 0.999, 0.5)
	a($comb)
	a($bp)
    j($comb, $noise)
    j($bp, $comb)
    j($lp, $bp)
    $i * 1.61834
}

$v = vis_fft($lp)
out($lp)

while (1) {
	$v.render($v)
    lfo1($lp, "Freq")
    ar($noise, "Amp")

    while( get_event() ) { if EVT[ EVT_TYPE ] == EVT_QUIT { shut() halt } }
}
