include "embe.pixi"
include "embe/comb.pixi"

// Create mixer
$m = mix()
//$noise = osc_noise(0.01)
$noise = osc_sqr(80, 0.005)
//$noise = in(0)

$i = 1 while ($i <= 8) {
    $f = comb($i * 40, 0.9999)
    $bp = flt_lp($i * 80, 199)
    j($bp, $noise)
    j($f, $bp)
    j($m, $f)
    $i + 1
}

$bp = flt_lp(600, 90)


//$o1 = osc_sqr(110, 0.1)
//$o2 = osc_sin(660, 0.1)
//$o3 = osc_noise(0.1)
//$in = in(0)


// Join ("j") our oscillators to the mixer
//j($m, $o1)
//j($m, $o2)
//j($m, $o3)
//j($m, $in)

// Create band-pass filter with cutoff frequency == 110Hz
// and resonance value = 100% (if we will use value > 100)
// filter will start to self-oscillate

$ws = waveshaper({
    $v = 2 * $1
    if $v > 0.99 {
        $v = 0.99
    }
    if $v < -0.99 {
        $v = -0.99
    }
    ret ($v)
})

j($bp, $m)
j($ws, $bp)

// Create visualizer
$v1 = vis_fft()

// Join our filter to visualizer
j($v1, $ws)

// Send our filter to the output
out($ws)

while (1) {

    lfo1($bp, "Freq")
    // Some visualization
    $v1.render($v1)

    while( get_event() ) { if EVT[ EVT_TYPE ] == EVT_QUIT { halt } }
}
