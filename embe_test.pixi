include "embe.pixi"
include "embe/osc.pixi"
include "embe/mod.pixi"
include "embe/biquad.pixi"
include "embe/comb.pixi"
include "embe/waveshaper.pixi"
include "embe/vis.pixi"

//set_pixel_size(WINDOW_XSIZE / 240)
//resize(get_screen(), WINDOW_XSIZE, WINDOW_YSIZE)

$ws = a(waveshaper({
    $v = $1
    /*if $v > 0.99 {
        $v = 0.99
    }
    if $v < -0.99 {
        $v = -0.99
    }*/
    ret ($v)
}))


$noise = a(osc_noise(0.25))
$lp = a(lp(4400, 0.9, 0.005))
$out = a(out())

j($out, $lp)

$i = 1 while ($i <= 16) {
    $comb = a(comb($i * 32, 0.999, 0.1))
    $bp = a(bp($i * 32, 0.8, 0.5))
    j($comb, $noise)
    j($bp, $comb)
    j($lp, $bp)
    $i + 1.61834
}

$v = vis_fft()
j($v, $lp)

run($out)

while (1) {
    $v.render($v)
    lfo1($lp, "Freq")
    ar($noise, "Amp")

    while(get_event()) {
        if EVT[ EVT_TYPE ] == EVT_QUIT {
            break2
        }
    }
}
shut()
halt    
